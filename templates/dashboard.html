{% extends 'base.html' %}

{% block title %}Hello World!{% end %}

{% block extra_head %}
<script type="application/javascript">
    window.onload = function() {
        const ws = new WebSocket("ws://localhost:8888/data");
        ws.binaryType = "arraybuffer";

        ws.onopen = function () {
            ws.send(
                JSON.stringify({
                    topic: "update",
                    id: "all"
                })
            );
        };

        ws.onmessage = function (e) {
            const message = JSON.parse(e.data);

            const event = new MessageEvent("update", {
                data: message.data
            });
            document.getElementById(message.id).dispatchEvent(event);
        };

        window.ws = ws;
    }
</script>
{% end %}

{% block content %}
<h1>Hello World!</h1>

<div class="row">
    {% for card in layout %}
        <!-- TODO replace this with the correct UIModule -->
        {% module Image(card) %}
    {% end %}
</div>

{% end %}